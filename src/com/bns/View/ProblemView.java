package com.bns.View;import java.io.*;import java.util.*;import org.json.*;import android.app.*;import android.content.*;import android.os.*;import android.speech.tts.*;import android.speech.tts.TextToSpeech.OnInitListener;import android.util.*;import android.view.*;import android.widget.*;import com.bns.Common.*;import com.bns.CustomAdapter.*;import com.bns.Eliars.*;public class ProblemView extends Activity implements OnInitListener{	int chapterNumber = 0;	final int problemCounter = 5;	int clickCounter = 0;		ArrayList<String> spellList = null;	ArrayList<String> meanList = null;		final int WPROBLEM = 0;	final int MPROBLEM = 1;		TextToSpeech _tts;	String _ttsString;		int type;		@Override	protected void onCreate(Bundle savedInstanceState) {		// TODO Auto-generated method stub		super.onCreate(savedInstanceState);		this.setContentView(R.layout.list_view);				Common.ViewList.put("ProblemView", this);		type = this.WPROBLEM;		chapterNumber = this.getIntent().getIntExtra("Chapter", 0);		if(chapterNumber == 0)		{			Intent intent = new Intent(this,ChapterView.class);			this.startActivity(intent);			Common.ViewList.get("ProblemView").finish();		}		else		{				this.parsingJson();			this.getList();						List<String> temp = this.setList(meanList,5);			this.setProblemView(temp,this.WPROBLEM);			this.setListView(temp);		}	}		private void getList()	{		spellList = new ArrayList<String>();		meanList = new ArrayList<String>();		int size = Common.wordList.size();				for(int index = 0;index < size; index++)		{			HashMap<String,String> temp = Common.wordList.get(index);			String spell = temp.get("spell");			String mean = temp.get("mean");						spellList.add(spell);			meanList.add(mean);		}	}		private List<String> setList(List<String> list,int wantSize)	{    	HashSet<String> tempSet = new HashSet<String>();    	List<String>result = new ArrayList<String>();    	int range = list.size();    	    	while(tempSet.size() < wantSize)    	{    		int index = (int)(Math.random()*range);    		String tempString = list.get(index);    		tempSet.add(tempString);    	}    	    	Iterator<String> iterator = tempSet.iterator();    	    	while(iterator.hasNext())    	{    		try    		{    			String temp = iterator.next();    			result.add(temp);    		}    		catch(Exception e)    		{    		}    	}    	    	return result;	}		private void setProblemView(List<String> temp,int type)	{		int range = temp.size();		int location = (int)(Math.random() * range);		String tempString = temp.get(location);		for(int index = 0; index < range;index++)		{			HashMap<String,String> tempMap = Common.wordList.get(index);			switch(type)			{			case 0:				String meanString = tempMap.get("mean");				if(tempString.equals(meanString))				{					TextView textView = (TextView)this.findViewById(R.id.problemText);					String result = tempMap.get("spell");					textView.setText(result);					this.OnListen(result);				}				break;			case 1:				String spellString = tempMap.get("spell");				if(tempString.equals(spellString))				{					TextView textView = (TextView)this.findViewById(R.id.problemText);					String result = tempMap.get("mean");					this._tts.speak(result, TextToSpeech.QUEUE_FLUSH, null);					textView.setText(result);					this.OnListen(result);				}				break;			default:				break;				}		}	}		private void setListView(List<String> displayList)	{		ProblemListAdapter adapter = new ProblemListAdapter(this, displayList);		ListView listView = (ListView)this.findViewById(R.id.answer);		listView.setAdapter(adapter);	}		private String json2String(int chapterNumber)	{		String json = null;				try		{			InputStream is = this.getAssets().open("chapter"+ chapterNumber +".json");			int size = is.available();						byte [] buffer = new byte[size];						is.read(buffer);			is.close();			json = new String(buffer,"UTF-8");		}		catch(Exception e)		{			Toast.makeText(this, "JSON File Not Exist", Toast.LENGTH_SHORT).show();		}				return json;	}	private void parsingJson()	{		String json = this.json2String(chapterNumber);		try		{			JSONObject jObj = new JSONObject(json);			JSONArray jArray = jObj.getJSONArray("word");			ArrayList<HashMap<String,String>> arrayList = new ArrayList<HashMap<String,String>>();			HashMap<String,String> word = null;			int size = jArray.length();						for(int index = 0;index < size; index++)			{				word = new HashMap<String,String>();				JSONObject jWord = jArray.getJSONObject(index);				String jSpell = jWord.getString("spell");				String jMean = jWord.getString("mean");				word.put("spell", jSpell);				word.put("mean", jMean);				arrayList.add(word);								jSpell = null;				jMean = null;				word = null;			}						Common.wordList = arrayList;		}		catch(Exception e)		{			Toast.makeText(this, "Error Json Parsing", Toast.LENGTH_SHORT).show();		}			}		@Override	public boolean onKeyDown(int keyCode, KeyEvent event) {		// TODO Auto-generated method stub		switch(keyCode)		{		case KeyEvent.KEYCODE_BACK:			Intent intent = new Intent(this,ChapterView.class);			this.startActivity(intent);			Common.ViewList.get("ProblemView").finish();			return true;		default:			return super.onKeyDown(keyCode, event);		}	}	private void checkProblem(int clickCounter)	{		TextView textView = (TextView)this.findViewById(R.id.problemText);		if(Common.checkList == null) Common.checkList = new ArrayList<Boolean>();		String problemString = textView.getText().toString();		int position = 0;		int size = ProblemListAdapter.check.size();				for(int index = 0; index < size;index++)		{			String result = ProblemListAdapter.check.get(index);			if(result.equals("ON"))			{				position = index;				break;			}		}				String result = ProblemListAdapter.checkString.get(position);				int _position = this.getPosition(result, meanList);		int _position_1 = this.getPosition(problemString, spellList);				if(_position == _position_1)		{			Common.checkList.add(clickCounter,true);		}		else		{			Common.checkList.add(clickCounter,false);		}	}		private int getPosition(String obj,List<String> list)	{		int count = 0;		boolean b = list.contains(obj);		if(!b)		{			return count;		}				Iterator<String> iterator = list.iterator();		while(iterator.hasNext())		{			String result = iterator.next();			if(obj.equals(result))			{				return count;			}			else			{				count ++;			}		}		return 0;	}		public void onClicked(View view)	{			this.checkProblem(clickCounter);				if(this.clickCounter < this.problemCounter - 1 )		{			if(clickCounter == 3)			{				Button button = (Button)this.findViewById(R.id.nextBtn);				button.setText("Result View");			}						this.getList();					List<String> temp = this.setList(meanList,5);			this.setProblemView(temp,this.WPROBLEM);			this.setListView(temp);			this.clickCounter++;		}		else		{			Intent intent = new Intent(this,ResultView.class);			Common.ViewList.get("ProblemView").finish();			this.startActivity(intent);			clickCounter = 0;		}	}		@Override	public void onInit(int status) {		// TODO Auto-generated method stub		if(status == TextToSpeech.SUCCESS)		{			this._tts.setLanguage(Locale.US);			this._tts.speak(this._ttsString, TextToSpeech.QUEUE_FLUSH, null);						Log.d("Tag", "TTS LOAD");		}		else if(status == TextToSpeech.ERROR)		{			Log.d("Tag", "TTS Don't LOAD");		}	}		@Override	protected void onDestroy() {	    	    if(_tts != null) {	        _tts.stop();	        _tts.shutdown();	    }	    super.onDestroy();	}		public void OnListen(View view)	{		TextView textView = (TextView)this.findViewById(R.id.problemText);		this._ttsString = textView.getText().toString();		this._tts = new TextToSpeech(this,this);	}		public void OnListen(String text)	{		this._ttsString = text;		this._tts = new TextToSpeech(this,this);	}}