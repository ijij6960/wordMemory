package com.bns.View;import java.io.*;import java.util.*;import org.json.*;import android.app.*;import android.content.*;import android.os.*;import android.util.*;import android.view.*;import android.widget.*;import com.bns.Common.*;import com.bns.CustomAdapter.*;import com.bns.Eliars.*;public class ProblemView extends Activity {	int chapterNumber = 0;	final int problemCounter = 5;	int clickCounter = 0;		ArrayList<String> spellList = null;	ArrayList<String> meanList = null;		final int WPROBLEM = 0;	final int MPROBLEM = 1;		int type;		@Override	protected void onCreate(Bundle savedInstanceState) {		// TODO Auto-generated method stub		super.onCreate(savedInstanceState);		this.setContentView(R.layout.list_view);				Common.ViewList.put("ProblemView", this);		type = this.WPROBLEM;		chapterNumber = this.getIntent().getIntExtra("Chapter", 0);		if(chapterNumber == 0)		{			Intent intent = new Intent(this,ChapterView.class);			this.startActivity(intent);			Common.ViewList.get("ProblemView").finish();		}		else		{			this.parsingJson();			this.getList();						List<String> temp = this.setList(meanList,5);			this.setProblemView(temp,this.WPROBLEM);			this.setListView(temp);		}	}		private void getList()	{		spellList = new ArrayList<String>();		meanList = new ArrayList<String>();		int size = Common.wordList.size();				for(int index = 0;index < size; index++)		{			HashMap<String,String> temp = Common.wordList.get(index);			String spell = temp.get("spell");			String mean = temp.get("mean");						spellList.add(spell);			meanList.add(mean);		}	}		private List<String> setList(List<String> list,int wantSize)	{    	HashSet<String> tempSet = new HashSet<String>();    	List<String>result = new ArrayList<String>();    	int range = list.size();    	    	while(tempSet.size() < wantSize)    	{    		int index = (int)(Math.random()*range);    		String tempString = list.get(index);    		tempSet.add(tempString);    	}    	    	Iterator<String> iterator = tempSet.iterator();    	    	while(iterator.hasNext())    	{    		try    		{    			String temp = iterator.next();    			result.add(temp);    		}    		catch(Exception e)    		{    		}    	}    	    	return result;	}		private void setProblemView(List<String> temp,int type)	{		int range = temp.size();		int location = (int)(Math.random() * range);		String tempString = temp.get(location);		for(int index = 0; index < range;index++)		{			HashMap<String,String> tempMap = Common.wordList.get(index);			switch(type)			{			case 0:				String meanString = tempMap.get("mean");				if(tempString.equals(meanString))				{					TextView textView = (TextView)this.findViewById(R.id.problemText);					String result = tempMap.get("spell");					textView.setText(result);				}				break;			case 1:				String spellString = tempMap.get("spell");				if(tempString.equals(spellString))				{					TextView textView = (TextView)this.findViewById(R.id.problemText);					String result = tempMap.get("mean");					textView.setText(result);				}				break;			default:				break;				}		}	}		private void setListView(List<String> displayList)	{		ProblemListAdapter adapter = new ProblemListAdapter(this, displayList);		ListView listView = (ListView)this.findViewById(R.id.answer);		listView.setAdapter(adapter);	}		private String json2String(int chapterNumber)	{		String json = null;				try		{			InputStream is = this.getAssets().open("chapter"+ chapterNumber +".json");			int size = is.available();						byte [] buffer = new byte[size];						is.read(buffer);			is.close();			json = new String(buffer,"UTF-8");		}		catch(Exception e)		{			Toast.makeText(this, "JSON File Not Exist", Toast.LENGTH_SHORT).show();		}				return json;	}	private void parsingJson()	{		String json = this.json2String(chapterNumber);		try		{			JSONObject jObj = new JSONObject(json);			JSONArray jArray = jObj.getJSONArray("word");			ArrayList<HashMap<String,String>> arrayList = new ArrayList<HashMap<String,String>>();			HashMap<String,String> word = null;			int size = jArray.length();						for(int index = 0;index < size; index++)			{				word = new HashMap<String,String>();				JSONObject jWord = jArray.getJSONObject(index);				String jSpell = jWord.getString("spell");				String jMean = jWord.getString("mean");				word.put("spell", jSpell);				word.put("mean", jMean);				arrayList.add(word);								jSpell = null;				jMean = null;				word = null;			}						Common.wordList = arrayList;		}		catch(Exception e)		{			Toast.makeText(this, "Error Json Parsing", Toast.LENGTH_SHORT).show();		}			}		@Override	public boolean onKeyDown(int keyCode, KeyEvent event) {		// TODO Auto-generated method stub		switch(keyCode)		{		case KeyEvent.KEYCODE_BACK:			Intent intent = new Intent(this,ChapterView.class);			this.startActivity(intent);			Common.ViewList.get("ProblemView").finish();			return true;		default:			return super.onKeyDown(keyCode, event);		}	}	private void checkProblem(int clickCounter)	{		TextView textView = (TextView)this.findViewById(R.id.problemText);		String problemString = textView.getText().toString();		if(Common.checkList == null) Common.checkList = new ArrayList<HashMap<Integer,Boolean>>();		int size = ProblemListAdapter.check.size();		int position = 0;				for(int index = 0; index < size;index++)		{			String isON = ProblemListAdapter.check.get(index);			if(isON.equals("ON"))			{				position = index;				break;			}		}				String answerString = ProblemListAdapter.checkString.get(position);				int _position = 0;		if(type == this.WPROBLEM)		{			Iterator<String> iterator = meanList.iterator();			while(iterator.hasNext())			{				String temp = iterator.next();				if(temp.equals(answerString))				{					break;				}				else				{					_position++;				}			}						String resultString = spellList.get(_position);			if(problemString.equals(resultString))			{				HashMap<Integer,Boolean>temp = new HashMap<Integer,Boolean>();				temp.put(clickCounter, true);				Common.checkList.add(temp);;				temp = null;			}			else			{				HashMap<Integer,Boolean>temp = new HashMap<Integer,Boolean>();				temp.put(clickCounter, false);				Common.checkList.add(temp);				temp = null;			}		}		else if(type == this.MPROBLEM)		{			Iterator<String> iterator = spellList.iterator();			while(iterator.hasNext())			{				String temp = iterator.next();				if(temp.equals(answerString))				{					break;				}				else				{					_position++;				}			}						String resultString = meanList.get(_position);						if(problemString.equals(resultString))			{				HashMap<Integer,Boolean>temp = new HashMap<Integer,Boolean>();				temp.put(clickCounter, true);				Common.checkList.add(temp);				temp = null;			}			else			{				HashMap<Integer,Boolean>temp = new HashMap<Integer,Boolean>();				temp.put(clickCounter, false);				Common.checkList.add(temp);				temp = null;			}		}	}		public void onClicked(View view)	{			this.checkProblem(clickCounter);				if(this.clickCounter < this.problemCounter - 1 )		{			if(clickCounter == 3)			{				Button button = (Button)this.findViewById(R.id.nextBtn);				button.setText("Result View");			}						this.getList();					List<String> temp = this.setList(meanList,5);			this.setProblemView(temp,this.WPROBLEM);			this.setListView(temp);			this.clickCounter++;		}		else		{			Intent intent = new Intent(this,ResultView.class);			Common.ViewList.get("ProblemView").finish();			this.startActivity(intent);			clickCounter = 0;		}	}}